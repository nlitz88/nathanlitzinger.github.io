<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker Networking: It's Not Magic! | Nathan Litzinger</title><meta name=keywords content><meta name=description content="For as long as I&rsquo;ve been learning Docker, I&rsquo;ve never had a good reason to sit down and try to understand some of the mystical Docker networking mechanisms that make spinning up a container so effortless. That is until yesterday when I was scratching my head wondering why one of my containers wasn&rsquo;t resolving my network&rsquo;s internal hostnames!
See, after a while of digging, it ocurred to me that the way Docker&rsquo;s container networks operate is strikingly similar to that of traditional networking."><meta name=author content="Nathan Litzinger"><link rel=canonical href=https://nlitz88.github.io/posts/dockernetworking/dockernetworking/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://nlitz88.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://nlitz88.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://nlitz88.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://nlitz88.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://nlitz88.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Docker Networking: It's Not Magic!"><meta property="og:description" content="For as long as I&rsquo;ve been learning Docker, I&rsquo;ve never had a good reason to sit down and try to understand some of the mystical Docker networking mechanisms that make spinning up a container so effortless. That is until yesterday when I was scratching my head wondering why one of my containers wasn&rsquo;t resolving my network&rsquo;s internal hostnames!
See, after a while of digging, it ocurred to me that the way Docker&rsquo;s container networks operate is strikingly similar to that of traditional networking."><meta property="og:type" content="article"><meta property="og:url" content="https://nlitz88.github.io/posts/dockernetworking/dockernetworking/"><meta property="og:image" content="https://nlitz88.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-05T00:30:35+00:00"><meta property="article:modified_time" content="2023-01-05T00:30:35+00:00"><meta property="og:site_name" content="Nathan Litzinger"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nlitz88.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Docker Networking: It's Not Magic!"><meta name=twitter:description content="For as long as I&rsquo;ve been learning Docker, I&rsquo;ve never had a good reason to sit down and try to understand some of the mystical Docker networking mechanisms that make spinning up a container so effortless. That is until yesterday when I was scratching my head wondering why one of my containers wasn&rsquo;t resolving my network&rsquo;s internal hostnames!
See, after a while of digging, it ocurred to me that the way Docker&rsquo;s container networks operate is strikingly similar to that of traditional networking."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://nlitz88.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Docker Networking: It's Not Magic!","item":"https://nlitz88.github.io/posts/dockernetworking/dockernetworking/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Docker Networking: It's Not Magic!","name":"Docker Networking: It\u0027s Not Magic!","description":"For as long as I\u0026rsquo;ve been learning Docker, I\u0026rsquo;ve never had a good reason to sit down and try to understand some of the mystical Docker networking mechanisms that make spinning up a container so effortless. That is until yesterday when I was scratching my head wondering why one of my containers wasn\u0026rsquo;t resolving my network\u0026rsquo;s internal hostnames!\nSee, after a while of digging, it ocurred to me that the way Docker\u0026rsquo;s container networks operate is strikingly similar to that of traditional networking.","keywords":[],"articleBody":" For as long as I’ve been learning Docker, I’ve never had a good reason to sit down and try to understand some of the mystical Docker networking mechanisms that make spinning up a container so effortless. That is until yesterday when I was scratching my head wondering why one of my containers wasn’t resolving my network’s internal hostnames!\nSee, after a while of digging, it ocurred to me that the way Docker’s container networks operate is strikingly similar to that of traditional networking. I.e., subnets of connected hosts with routers to route packets between subnets. In the case of Docker, those hosts are containers and the routers sort of implicitly sit in front of every docker network that’s created (the docker Daemon does the routing, effectively).\nNow, after doing some more research, and mainly after reading this medium article, it becomes apparent that this isn’t actually quite how it works.\nHaving said this, however, if I could go back and give myself a piece of advice when starting out with Docker, I would say this: just think of Docker networks as any old subnet or network as a starting mental model.\nA Gross Oversimplication WAIT–don’t crucify me. I know this probably isn’t how it works at the lowest level. It is, however, the mental model that I have been using to initially approach design with Docker in my homelab. Even if it’s not 100% technically accurate all the time, having a mental model to help guide my Docker design decisions is immensely helpful.\nFor instance: I can make informed decisions as to what containers I should place in the same Docker network, which is sort of just Docker-speak for a subnet/broadcast domain. I.e., when I want containers to be able to talk to each other without having to go through a router or firewall.\nNot That Far Off, Though While I know I’ve been saying the above things for the sake of a mental model, it’s actually not too far from the truth! Here are a few points I’ve thought about to help me understand this better:\nContainers are executed via a container runtime, like containerd. For all intents and purposes, imagine these are just like little virtual machines running in your host OS.\nThe containers you have running have virtual network cards, just like a VM would, or just like a physical host would. To talk to that container, you have to connect that container to a network you can route to.\nThe Docker daemon is like a sysadmin for this whole set up.\nThat is, it sets up the subnets that the different containers are connected to, it adds routers to make it possible for these subnets to talk to each other, or just to talk to the subnet that your computer’s NIC is connected to.\nHowever, those routers the Docker Daemon sets up can’t directly connect to the host. Instead, the Docker Daemon will act as a router that sits between all of the Docker network subnet routers and the host. It acts as a middleman for any requests to/from the containers!\nIt does this by binding to the ports that the containers specified on launch, so that packets directed to host port 3377 will be routed to whichever container network has a container listening on the container port it is mapped to, maybe like port 37. You can see here how if I run a netstat -tulnp, we can see these docker-proxy processes running that bind to these ports so the OS knows which process to forward those requests to. That process will then somehow forward that along to the “router” for the destination container network! While not totally correct, I like to imagine this works sort of like Network Address Translation, or NAT.\nThen, in order for the router of that container network (which I think is somehow implemented as a part of the Docker daemon) to actually talk to any of the containers on that container network/subnet, it needs a network interface to connect to these containers’ interfaces. And this is no joke–just run ip addr to see for yourself! Clarification As I mentioned above, no–this isn’t quite how Docker’s bridge networks work. However, one of the main things that I learned in all this (and wanted to share) is that Docker manages its networks through almost the same facilities that we’re used to working with for traditional networking. It creates network interfaces, establishes these virtual subnet-resembling networks, and does a NAT like process to forward packets from the host OS to containers.\nSo while I don’t want you reading my above explanation thinking that you’ve mastered Docker networking, I hope it has opened your eyes at least a little bit to what’s really going on under the hood and how Docker pulls of what it does.\nA Diagram For This Not-So-Accurate Model As I began thinking about Docker networks in this way at a high level, I drafted up this drawing to get my thoughts out. Again, in case it would help anyone understand, I included it here.\nThis browser does not support PDFs. Please download the PDF to view it: Download PDF.\nUpdate: Some Affirmation It’s winter break–which means this is the only time of the year that I have time to make updates to my homelab. As I continue to drop further and further down the rabbit hole of self-hosted services and network security, I stumbled upon Network Chuck’s Docker networking guide. Sure enough, a lot of my observations actually turned out to be true–cool!\n","wordCount":"924","inLanguage":"en","datePublished":"2023-01-05T00:30:35Z","dateModified":"2023-01-05T00:30:35Z","author":{"@type":"Person","name":"Nathan Litzinger"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://nlitz88.github.io/posts/dockernetworking/dockernetworking/"},"publisher":{"@type":"Organization","name":"Nathan Litzinger","logo":{"@type":"ImageObject","url":"https://nlitz88.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://nlitz88.github.io/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://nlitz88.github.io/litzingernathanresume.pdf title=Resume><span>Resume</span></a></li><li><a href=https://nlitz88.github.io/posts title=Posts><span>Posts</span></a></li><li><a href=https://nlitz88.github.io/photography title=Photography><span>Photography</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://nlitz88.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://nlitz88.github.io/posts/>Posts</a></div><h1 class=post-title>Docker Networking: It's Not Magic!</h1><div class=post-meta>January 5, 2023&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Nathan Litzinger&nbsp;|&nbsp;<a href=https://github.com/nlitz88/portfolio/content/posts/dockernetworking/dockernetworking.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p><img loading=lazy src=/posts/dockernetworking/bridge_network.png alt="Docker Network">
For as long as I&rsquo;ve been learning Docker, I&rsquo;ve never had a good reason to sit down and try to understand some of
the <em>mystical</em> Docker networking mechanisms that make spinning up a container so effortless. That is until yesterday when I
was scratching my head wondering why one of my containers wasn&rsquo;t resolving my network&rsquo;s internal hostnames!</p><p>See, after a while of digging, it ocurred to me that the way Docker&rsquo;s container networks operate is strikingly
similar to that of traditional networking. I.e., subnets of connected hosts with routers to route packets
between subnets. In the case of Docker, those hosts are containers and the routers sort of implicitly sit in front
of every docker network that&rsquo;s created (the docker Daemon does the routing, effectively).</p><p>Now, after doing some more research, and mainly after reading <a href=https://medium.com/techlog/diving-into-linux-networking-and-docker-bridge-veth-and-iptables-a05eb27b1e72>this medium
article</a>,
it becomes apparent that this isn&rsquo;t actually <em>quite</em> how it works.</p><p>Having said this, however, if I could go back and give myself a piece of advice when starting out with Docker, I
would say this: <strong>just think of Docker networks as any old subnet or network</strong> as a starting mental model.</p><h2 id=a-gross-oversimplication>A Gross Oversimplication<a hidden class=anchor aria-hidden=true href=#a-gross-oversimplication>#</a></h2><p>WAIT&ndash;don&rsquo;t crucify me. I know this probably isn&rsquo;t how it works at the lowest level. It is, however, the mental
model that I have been using to initially approach design with Docker in my homelab. Even if it&rsquo;s not 100%
technically accurate all the time, having a mental model to help guide my Docker design decisions is immensely
helpful.</p><p>For instance: I can make informed decisions as to what containers I should place in the same <strong>Docker network</strong>, which
is sort of just Docker-speak for a subnet/broadcast domain. I.e., when I want containers to be able to talk to each
other without having to go through a router or firewall.</p><h2 id=not-that-far-off-though>Not That Far Off, Though<a hidden class=anchor aria-hidden=true href=#not-that-far-off-though>#</a></h2><p>While I know I&rsquo;ve been saying the above things for the sake of a mental model, it&rsquo;s actually not <em>too far</em> from the
truth! Here are a few points I&rsquo;ve thought about to help me understand this better:</p><ul><li><p>Containers are executed via a <strong>container runtime</strong>, like <strong>containerd</strong>. For all intents and purposes, imagine these are just like
little virtual machines running in your host OS.</p></li><li><p>The containers you have running have virtual network cards, just like a VM would, or just like a physical host
would. To talk to that container, you have to connect that container to a network you can route to.</p></li><li><p>The Docker daemon is like a sysadmin for this whole set up.</p></li><li><p>That is, it sets up the subnets that the different containers are connected to, it adds routers to make it
possible for these subnets to talk to each other, or just to talk to the subnet that your computer&rsquo;s NIC is
connected to.</p></li><li><p>However, those routers the Docker Daemon sets up can&rsquo;t directly connect to the host. Instead, the Docker Daemon
will act as a router that sits between all of the Docker network subnet routers and the host. It acts as a
middleman for any requests to/from the containers!</p></li><li><p>It does this by binding to the ports that the containers
specified on launch, so that packets directed to host port 3377 will be routed to whichever container network
has a container listening on the container port it is mapped to, maybe like port 37. You can see here how if I
run a <code>netstat -tulnp</code>, we can see these <code>docker-proxy</code> processes running that bind to these ports so the
OS knows which process to forward those requests to. That process will then somehow forward that along to the
&ldquo;router&rdquo; for the destination container network! <img loading=lazy src=/posts/dockernetworking/docker_binding.png alt="Docker Binding">
While not totally correct, I like to imagine this works sort of like <strong>Network Address Translation</strong>, or <strong>NAT</strong>.</p></li><li><p>Then, in order for the router of that container network (which I think is somehow implemented as a part of the
Docker daemon) to actually talk to any of the containers on that container network/subnet, it needs a network
interface to connect to these containers&rsquo; interfaces. And this is no joke&ndash;just run <code>ip addr</code> to see for
yourself!
<img loading=lazy src=/posts/dockernetworking/ip_addr_1.png alt="Virtual Ethernet Interfaces Created by Docker">
<img loading=lazy src=/posts/dockernetworking/ip_addr_2.png alt="Virtual Ethernet Interfaces Created by Docker"></p></li></ul><h2 id=clarification>Clarification<a hidden class=anchor aria-hidden=true href=#clarification>#</a></h2><p>As I mentioned above, no&ndash;this isn&rsquo;t <em>quite</em> how Docker&rsquo;s bridge networks work. However, one of the main things
that I learned in all this (and wanted to share) is that Docker manages its networks through almost the same
facilities that we&rsquo;re used to working with for traditional networking. It creates network interfaces, establishes
these virtual subnet-resembling networks, and does a NAT like process to forward packets from the host OS to
containers.</p><p>So while I don&rsquo;t want you reading my above explanation thinking that you&rsquo;ve mastered Docker networking, I hope it
has opened your eyes at least a little bit to what&rsquo;s really going on under the hood and how Docker pulls of what it
does.</p><h2 id=a-diagram-for-this-not-so-accurate-model>A Diagram For This Not-So-Accurate Model<a hidden class=anchor aria-hidden=true href=#a-diagram-for-this-not-so-accurate-model>#</a></h2><p>As I began thinking about Docker networks in this way at a high level, I drafted up this drawing to get my thoughts
out. Again, in case it would help anyone understand, I included it here.</p><object data=/posts/dockernetworking/docker_networking_diagram.pdf type=application/pdf width=700px height=700px><embed src=/posts/dockernetworking/docker_networking_diagram.pdf><p>This browser does not support PDFs. Please download the PDF to view it: <a href=/posts/dockernetworking/docker_networking_diagram.pdf>Download PDF</a>.</p></embed></object><h2 id=update-some-affirmation>Update: Some Affirmation<a hidden class=anchor aria-hidden=true href=#update-some-affirmation>#</a></h2><p>It&rsquo;s winter break&ndash;which means this is the only time of the year that I have time to make updates to my homelab. As
I continue to drop further and further down the rabbit hole of self-hosted services and network security, I
stumbled upon <a href="https://www.youtube.com/watch?v=bKFMS5C4CG0">Network Chuck&rsquo;s Docker networking guide</a>. Sure enough,
a lot of my observations actually turned out to be true&ndash;cool!</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://nlitz88.github.io/posts/birddetection/birddetection/><span class=title>Next »</span><br><span>Bird Detection With YOLOv7</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://nlitz88.github.io/>Nathan Litzinger</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>